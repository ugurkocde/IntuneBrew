#!/bin/bash
# Uninstall script for TunnelBear
# Generated by IntuneBrew

# Exit on error
set -e

echo "Uninstalling TunnelBear..."

# Check if running as root
if [ "$EUID" -ne 0 ]; then
  echo "Please run as root"
  exit 1
fi

# Kill application process if running
echo "Stopping TunnelBear if running..."
pkill -f "TunnelBear" 2>/dev/null || true

# Unload service com.tunnelbear.mac.tbeard
echo "Unloading service com.tunnelbear.mac.tbeard..."
launchctl unload -w /Library/LaunchAgents/com.tunnelbear.mac.tbeard.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.tunnelbear.mac.tbeard.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.tunnelbear.mac.tbeard.plist 2>/dev/null || true

# Kill application with bundle ID com.tunnelbear.mac.TunnelBear if running
echo "Stopping application with bundle ID com.tunnelbear.mac.TunnelBear if running..."
killall -9 "com.tunnelbear.mac.TunnelBear" 2>/dev/null || true

# Remove /Applications/TunnelBear.app
echo "Removing /Applications/TunnelBear.app..."
if [ -d "/Applications/TunnelBear.app" ]; then
    rm -rf "/Applications/TunnelBear.app" 2>/dev/null || true
elif [ -f "/Applications/TunnelBear.app" ]; then
    rm -f "/Applications/TunnelBear.app" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.ApplicationRecentDocuments/com.tunnelbear.mac.tunnelbear.sfl*
echo "Removing $HOME/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.ApplicationRecentDocuments/com.tunnelbear.mac.tunnelbear.sfl*..."
if [ -d "$HOME/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.ApplicationRecentDocuments/com.tunnelbear.mac.tunnelbear.sfl*" ]; then
    rm -rf "$HOME/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.ApplicationRecentDocuments/com.tunnelbear.mac.tunnelbear.sfl*" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.ApplicationRecentDocuments/com.tunnelbear.mac.tunnelbear.sfl*" ]; then
    rm -f "$HOME/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.ApplicationRecentDocuments/com.tunnelbear.mac.tunnelbear.sfl*" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/com.tunnelbear.mac.TunnelBear
echo "Removing $HOME/Library/Application Support/com.tunnelbear.mac.TunnelBear..."
if [ -d "$HOME/Library/Application Support/com.tunnelbear.mac.TunnelBear" ]; then
    rm -rf "$HOME/Library/Application Support/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/com.tunnelbear.mac.TunnelBear" ]; then
    rm -f "$HOME/Library/Application Support/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/TunnelBear
echo "Removing $HOME/Library/Application Support/TunnelBear..."
if [ -d "$HOME/Library/Application Support/TunnelBear" ]; then
    rm -rf "$HOME/Library/Application Support/TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/TunnelBear" ]; then
    rm -f "$HOME/Library/Application Support/TunnelBear" 2>/dev/null || true
fi

# Remove $HOME/Library/Caches/com.crashlytics.data/com.tunnelbear.mac.TunnelBear
echo "Removing $HOME/Library/Caches/com.crashlytics.data/com.tunnelbear.mac.TunnelBear..."
if [ -d "$HOME/Library/Caches/com.crashlytics.data/com.tunnelbear.mac.TunnelBear" ]; then
    rm -rf "$HOME/Library/Caches/com.crashlytics.data/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/Caches/com.crashlytics.data/com.tunnelbear.mac.TunnelBear" ]; then
    rm -f "$HOME/Library/Caches/com.crashlytics.data/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
fi

# Remove $HOME/Library/Caches/com.plausiblelabs.crashreporter.data/com.tunnelbear.mac.TunnelBear
echo "Removing $HOME/Library/Caches/com.plausiblelabs.crashreporter.data/com.tunnelbear.mac.TunnelBear..."
if [ -d "$HOME/Library/Caches/com.plausiblelabs.crashreporter.data/com.tunnelbear.mac.TunnelBear" ]; then
    rm -rf "$HOME/Library/Caches/com.plausiblelabs.crashreporter.data/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/Caches/com.plausiblelabs.crashreporter.data/com.tunnelbear.mac.TunnelBear" ]; then
    rm -f "$HOME/Library/Caches/com.plausiblelabs.crashreporter.data/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
fi

# Remove $HOME/Library/Caches/com.tunnelbear.*
echo "Removing $HOME/Library/Caches/com.tunnelbear.*..."
if [ -d "$HOME/Library/Caches/com.tunnelbear.*" ]; then
    rm -rf "$HOME/Library/Caches/com.tunnelbear.*" 2>/dev/null || true
elif [ -f "$HOME/Library/Caches/com.tunnelbear.*" ]; then
    rm -f "$HOME/Library/Caches/com.tunnelbear.*" 2>/dev/null || true
fi

# Remove $HOME/Library/Caches/io.fabric.sdk.mac.data/com.tunnelbear.mac.TunnelBear
echo "Removing $HOME/Library/Caches/io.fabric.sdk.mac.data/com.tunnelbear.mac.TunnelBear..."
if [ -d "$HOME/Library/Caches/io.fabric.sdk.mac.data/com.tunnelbear.mac.TunnelBear" ]; then
    rm -rf "$HOME/Library/Caches/io.fabric.sdk.mac.data/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/Caches/io.fabric.sdk.mac.data/com.tunnelbear.mac.TunnelBear" ]; then
    rm -f "$HOME/Library/Caches/io.fabric.sdk.mac.data/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
fi

# Remove $HOME/Library/Cookies/com.tunnelbear.mac.TunnelBear.binarycookies
echo "Removing $HOME/Library/Cookies/com.tunnelbear.mac.TunnelBear.binarycookies..."
if [ -d "$HOME/Library/Cookies/com.tunnelbear.mac.TunnelBear.binarycookies" ]; then
    rm -rf "$HOME/Library/Cookies/com.tunnelbear.mac.TunnelBear.binarycookies" 2>/dev/null || true
elif [ -f "$HOME/Library/Cookies/com.tunnelbear.mac.TunnelBear.binarycookies" ]; then
    rm -f "$HOME/Library/Cookies/com.tunnelbear.mac.TunnelBear.binarycookies" 2>/dev/null || true
fi

# Remove $HOME/Library/HTTPStorages/com.tunnelbear.mac.TunnelBear
echo "Removing $HOME/Library/HTTPStorages/com.tunnelbear.mac.TunnelBear..."
if [ -d "$HOME/Library/HTTPStorages/com.tunnelbear.mac.TunnelBear" ]; then
    rm -rf "$HOME/Library/HTTPStorages/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/HTTPStorages/com.tunnelbear.mac.TunnelBear" ]; then
    rm -f "$HOME/Library/HTTPStorages/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
fi

# Remove $HOME/Library/LaunchAgents/com.tunnelbear.mac.tbeara.plist
echo "Removing $HOME/Library/LaunchAgents/com.tunnelbear.mac.tbeara.plist..."
if [ -d "$HOME/Library/LaunchAgents/com.tunnelbear.mac.tbeara.plist" ]; then
    rm -rf "$HOME/Library/LaunchAgents/com.tunnelbear.mac.tbeara.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/LaunchAgents/com.tunnelbear.mac.tbeara.plist" ]; then
    rm -f "$HOME/Library/LaunchAgents/com.tunnelbear.mac.tbeara.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Logs/TunnelBear
echo "Removing $HOME/Library/Logs/TunnelBear..."
if [ -d "$HOME/Library/Logs/TunnelBear" ]; then
    rm -rf "$HOME/Library/Logs/TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/Logs/TunnelBear" ]; then
    rm -f "$HOME/Library/Logs/TunnelBear" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/*.tunnelbear*.plist
echo "Removing $HOME/Library/Preferences/*.tunnelbear*.plist..."
if [ -d "$HOME/Library/Preferences/*.tunnelbear*.plist" ]; then
    rm -rf "$HOME/Library/Preferences/*.tunnelbear*.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/*.tunnelbear*.plist" ]; then
    rm -f "$HOME/Library/Preferences/*.tunnelbear*.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/WebKit/com.tunnelbear.mac.TunnelBear
echo "Removing $HOME/Library/WebKit/com.tunnelbear.mac.TunnelBear..."
if [ -d "$HOME/Library/WebKit/com.tunnelbear.mac.TunnelBear" ]; then
    rm -rf "$HOME/Library/WebKit/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
elif [ -f "$HOME/Library/WebKit/com.tunnelbear.mac.TunnelBear" ]; then
    rm -f "$HOME/Library/WebKit/com.tunnelbear.mac.TunnelBear" 2>/dev/null || true
fi

echo "Uninstallation complete!"
exit 0
