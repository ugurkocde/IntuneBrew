#!/bin/bash
# Uninstall script for GOG Galaxy
# Generated by IntuneBrew

# Exit on error
set -e

echo "Uninstalling GOG Galaxy..."

# Check if running as root
if [ "$EUID" -ne 0 ]; then
  echo "Please run as root"
  exit 1
fi

# Kill application process if running
echo "Stopping GOG Galaxy if running..."
pkill -f "GOG Galaxy" 2>/dev/null || true

# Unload service com.gog.galaxy.autoLauncher
echo "Unloading service com.gog.galaxy.autoLauncher..."
launchctl unload -w /Library/LaunchAgents/com.gog.galaxy.autoLauncher.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.gog.galaxy.autoLauncher.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.gog.galaxy.autoLauncher.plist 2>/dev/null || true

# Unload service com.gog.galaxy.ClientService
echo "Unloading service com.gog.galaxy.ClientService..."
launchctl unload -w /Library/LaunchAgents/com.gog.galaxy.ClientService.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.gog.galaxy.ClientService.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.gog.galaxy.ClientService.plist 2>/dev/null || true

# Unload service com.gog.galaxy.commservice
echo "Unloading service com.gog.galaxy.commservice..."
launchctl unload -w /Library/LaunchAgents/com.gog.galaxy.commservice.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.gog.galaxy.commservice.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.gog.galaxy.commservice.plist 2>/dev/null || true

# Remove /Library/LaunchDaemons/com.gog.galaxy.ClientService.plist
echo "Removing /Library/LaunchDaemons/com.gog.galaxy.ClientService.plist..."
if [ -d "/Library/LaunchDaemons/com.gog.galaxy.ClientService.plist" ]; then
    rm -rf "/Library/LaunchDaemons/com.gog.galaxy.ClientService.plist" 2>/dev/null || true
elif [ -f "/Library/LaunchDaemons/com.gog.galaxy.ClientService.plist" ]; then
    rm -f "/Library/LaunchDaemons/com.gog.galaxy.ClientService.plist" 2>/dev/null || true
fi

# Remove /Library/PrivilegedHelperTools/com.gog.galaxy.ClientService
echo "Removing /Library/PrivilegedHelperTools/com.gog.galaxy.ClientService..."
if [ -d "/Library/PrivilegedHelperTools/com.gog.galaxy.ClientService" ]; then
    rm -rf "/Library/PrivilegedHelperTools/com.gog.galaxy.ClientService" 2>/dev/null || true
elif [ -f "/Library/PrivilegedHelperTools/com.gog.galaxy.ClientService" ]; then
    rm -f "/Library/PrivilegedHelperTools/com.gog.galaxy.ClientService" 2>/dev/null || true
fi

# Remove /Users/Shared/GOG.com
echo "Removing /Users/Shared/GOG.com..."
if [ -d "/Users/Shared/GOG.com" ]; then
    rm -rf "/Users/Shared/GOG.com" 2>/dev/null || true
elif [ -f "/Users/Shared/GOG.com" ]; then
    rm -f "/Users/Shared/GOG.com" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/GOG.com
echo "Removing $HOME/Library/Application Support/GOG.com..."
if [ -d "$HOME/Library/Application Support/GOG.com" ]; then
    rm -rf "$HOME/Library/Application Support/GOG.com" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/GOG.com" ]; then
    rm -f "$HOME/Library/Application Support/GOG.com" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/com.gog.galaxy.cef.renderer.plist
echo "Removing $HOME/Library/Preferences/com.gog.galaxy.cef.renderer.plist..."
if [ -d "$HOME/Library/Preferences/com.gog.galaxy.cef.renderer.plist" ]; then
    rm -rf "$HOME/Library/Preferences/com.gog.galaxy.cef.renderer.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/com.gog.galaxy.cef.renderer.plist" ]; then
    rm -f "$HOME/Library/Preferences/com.gog.galaxy.cef.renderer.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/com.gog.galaxy.plist
echo "Removing $HOME/Library/Preferences/com.gog.galaxy.plist..."
if [ -d "$HOME/Library/Preferences/com.gog.galaxy.plist" ]; then
    rm -rf "$HOME/Library/Preferences/com.gog.galaxy.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/com.gog.galaxy.plist" ]; then
    rm -f "$HOME/Library/Preferences/com.gog.galaxy.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Saved Application State/com.gog.galaxy.savedState
echo "Removing $HOME/Library/Saved Application State/com.gog.galaxy.savedState..."
if [ -d "$HOME/Library/Saved Application State/com.gog.galaxy.savedState" ]; then
    rm -rf "$HOME/Library/Saved Application State/com.gog.galaxy.savedState" 2>/dev/null || true
elif [ -f "$HOME/Library/Saved Application State/com.gog.galaxy.savedState" ]; then
    rm -f "$HOME/Library/Saved Application State/com.gog.galaxy.savedState" 2>/dev/null || true
fi

echo "Uninstallation complete!"
exit 0
